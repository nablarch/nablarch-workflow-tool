<?xml version="1.0" encoding="UTF-8"?>

<component-configuration xmlns="http://tis.co.jp/nablarch/component-configuration"
                         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                         xsi:schemaLocation="http://tis.co.jp/nablarch/component-configuration">

    <import file="classpath:nablarch/tool/workflow/integration/db-default.xml"/>

    <component name="workflowConfig" class="nablarch.integration.workflow.WorkflowConfig">
        <property name="workflowDefinitionHolder" ref="workflowDefinitionHolder"/>
        <property name="workflowInstanceDao" ref="workflowInstanceDao"/>
        <property name="workflowInstanceFactory" ref="workflowInstanceFactory"/>
    </component>

    <component name="workflowDefinitionHolder" class="nablarch.integration.workflow.definition.WorkflowDefinitionHolder">
        <property name="workflowDefinitionLoader" ref="workflowLoader"/>
        <property name="systemTimeProvider">
            <component class="nablarch.core.date.BasicSystemTimeProvider"/>
        </property>
    </component>

    <component name="workflowLoader" class="nablarch.integration.workflow.definition.loader.DatabaseWorkflowDefinitionLoader">
        <property name="transactionManager" ref="testFwTran"/>
        <property name="workflowDefinitionSchema" ref="workflowDefinitionSchema"/>
    </component>

    <component name="workflowDefinitionSchema" class="nablarch.integration.workflow.definition.loader.WorkflowDefinitionSchema">
        <property name="workflowDefinitionTableName" value="WF_WORKFLOW_DEFINITION"/>
        <property name="laneTableName" value="WF_LANE"/>
        <property name="flowNodeTableName" value="WF_FLOW_NODE"/>
        <property name="eventTableName" value="WF_EVENT"/>
        <property name="taskTableName" value="WF_TASK"/>
        <property name="gatewayTableName" value="WF_GATEWAY"/>
        <property name="boundaryEventTableName" value="WF_BOUNDARY_EVENT"/>
        <property name="eventTriggerTableName" value="WF_BOUNDARY_EVENT_TRIGGER"/>
        <property name="sequenceFlowTableName" value="WF_SEQUENCE_FLOW"/>

        <property name="workflowIdColumnName" value="WORKFLOW_ID"/>
        <property name="workflowNameColumnName" value="WORKFLOW_NAME"/>
        <property name="versionColumnName" value="DEF_VERSION"/>
        <property name="effectiveDateColumnName" value="EFFECTIVE_DATE"/>

        <property name="laneIdColumnName" value="LANE_ID"/>
        <property name="laneNameColumnName" value="LANE_NAME"/>

        <property name="flowNodeIdColumnName" value="FLOW_NODE_ID"/>
        <property name="flowNodeNameColumnName" value="FLOW_NODE_NAME"/>

        <property name="eventTypeColumnName" value="EVENT_TYPE"/>
        <property name="multiInstanceTypeColumnName" value="MULTI_INSTANCE_TYPE"/>
        <property name="completionConditionColumnName" value="COMPLETION_CONDITION"/>
        <property name="gatewayTypeColumnName" value="GATEWAY_TYPE"/>

        <property name="boundaryEventTriggerIdColumnName" value="BOUNDARY_EVENT_TRIGGER_ID"/>
        <property name="boundaryEventTriggerNameColumnName" value="BOUNDARY_EVENT_TRIGGER_NAME"/>
        <property name="attachedTaskIdColumnName" value="ATTACHED_TASK_ID"/>

        <property name="sequenceFlowIdColumnName" value="SEQUENCE_FLOW_ID"/>
        <property name="sequenceFlowNameColumnName" value="SEQUENCE_FLOW_NAME"/>
        <property name="sourceFlowNodeIdColumnName" value="SOURCE_FLOW_NODE_ID"/>
        <property name="targetFlowNodeIdColumnName" value="TARGET_FLOW_NODE_ID"/>
        <property name="flowProceedConditionColumnName" value="FLOW_PROCEED_CONDITION"/>
    </component>

    <!-- プロセスインスタンス系テーブル -->
    <component name="workflowInstanceDao" class="nablarch.integration.workflow.dao.WorkflowInstanceDao">
        <property name="instanceIdGenerator" ref="instanceIdGenerator"/>
        <property name="instanceIdGenerateId" value="01"/>
        <property name="workflowInstanceSchema" ref="workflowInstanceSchema"/>
    </component>

    <!-- インスタンステーブル -->
    <component name="workflowInstanceSchema" class="nablarch.integration.workflow.dao.WorkflowInstanceSchema">
        <property name="instanceTableName" value="WF_INSTANCE"/>
        <property name="instanceFlowNodeTableName" value="WF_INSTANCE_FLOW_NODE"/>
        <property name="assignedUserTableName" value="WF_TASK_ASSIGNED_USER"/>
        <property name="assignedGroupTableName" value="WF_TASK_ASSIGNED_GROUP"/>
        <property name="activeFlowNodeTableName" value="WF_ACTIVE_FLOW_NODE"/>
        <property name="activeUserTaskTableName" value="WF_ACTIVE_USER_TASK"/>
        <property name="activeGroupTaskTableName" value="WF_ACTIVE_GROUP_TASK"/>

        <property name="instanceIdColumnName" value="INSTANCE_ID"/>
        <property name="workflowIdColumnName" value="WORKFLOW_ID"/>
        <property name="versionColumnName" value="DEF_VERSION"/>

        <property name="flowNodeIdColumnName" value="FLOW_NODE_ID"/>
        <property name="assignedUserColumnName" value="ASSIGNED_USER_ID"/>
        <property name="executionOrderColumnName" value="EXECUTION_ORDER"/>
        <property name="assignedGroupColumnName" value="ASSIGNED_GROUP_ID"/>
    </component>

    <component name="instanceIdGenerator" class="nablarch.tool.workflow.integration.helper.IdGeneratorImpl"/>

    <!-- ワークフローインスタンスファクトリ -->
    <component name="workflowInstanceFactory" class="nablarch.integration.workflow.BasicWorkflowInstanceFactory"/>

    <component name="initializer"
               class="nablarch.core.repository.initialization.BasicApplicationInitializer">
        <property name="initializeList">
            <list>
                <component-ref name="workflowInstanceDao"/>
            </list>
        </property>
    </component>
</component-configuration>
